<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Spotify Player</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .spotify-embed {
            width: 500px;
            height: 120px;
            display: flex;
            align-items: center;
            background-color: #181818;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: background 0.5s ease-in-out;
        }
        .cover img {
            width: 100px;
            height: 100px;
            border-radius: 8px;
        }
        .song-info {
            flex-grow: 1;
            margin-left: 15px;
            color: white;
        }
        .song-info h3 {
            margin: 5px 0;
            font-size: 18px;
        }
        .song-info p {
            margin: 0;
            font-size: 14px;
            color: #b3b3b3;
        }
        .play-button {
            background-color: white;
            border: none;
            color: #1DB954;
            padding: 10px;
            font-size: 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.3s;
        }
        .play-button:hover {
            background-color: #f1f1f1;
        }
    </style>
</head>
<body>

    <div class="spotify-embed" id="embed-container">
        <div class="cover">
            <img id="cover-img" src="" alt="Cover Art">
        </div>
        <div class="song-info">
            <h3 id="song-title">Φόρτωση...</h3>
            <p id="artist-name">Φόρτωση...</p>
        </div>
        <button class="play-button" id="play-btn">▶</button>
    </div>

    <script>
        const trackId = "1UtAIk72ORdykeV2puh04v"; // Spotify Track ID
        const embedContainer = document.getElementById("embed-container");
        let accessToken = ""; // Θα πάρουμε το access token για το Spotify API

        async function fetchSpotifyData() {
            const response = await fetch(`https://open.spotify.com/oembed?url=https://open.spotify.com/track/${trackId}`);
            const data = await response.json();
            
            document.getElementById("cover-img").src = data.thumbnail_url;
            document.getElementById("song-title").textContent = data.title;
            document.getElementById("artist-name").textContent = data.author_name;

            // Δυναμικό background color (χρησιμοποιούμε μέσο όρο των χρωμάτων του cover)
            extractColorsFromImage(data.thumbnail_url);
        }

        function extractColorsFromImage(imageUrl) {
            let img = new Image();
            img.crossOrigin = "Anonymous";
            img.src = imageUrl;
            img.onload = function() {
                let canvas = document.createElement("canvas");
                let ctx = canvas.getContext("2d");
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);

                let data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
                let r = 0, g = 0, b = 0, count = 0;

                for (let i = 0; i < data.length; i += 4) {
                    r += data[i];
                    g += data[i + 1];
                    b += data[i + 2];
                    count++;
                }

                r = Math.floor(r / count);
                g = Math.floor(g / count);
                b = Math.floor(b / count);

                embedContainer.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;
            };
        }

        async function getSpotifyAccessToken() {
            const clientId = "YOUR_SPOTIFY_CLIENT_ID";
            const clientSecret = "YOUR_SPOTIFY_CLIENT_SECRET";

            const response = await fetch("https://accounts.spotify.com/api/token", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                    "Authorization": "Basic " + btoa(clientId + ":" + clientSecret),
                },
                body: "grant_type=client_credentials",
            });

            const data = await response.json();
            accessToken = data.access_token;
        }

        async function playOnSpotify() {
            if (!accessToken) {
                await getSpotifyAccessToken();
            }

            fetch("https://api.spotify.com/v1/me/player/play", {
                method: "PUT",
                headers: {
                    "Authorization": "Bearer " + accessToken,
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    uris: [`spotify:track:${trackId}`],
                }),
            }).catch(error => console.error("Error playing track:", error));
        }

        document.getElementById("play-btn").addEventListener("click", playOnSpotify);

        fetchSpotifyData();
    </script>

</body>
</html>
